<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" type="text/css" href="../css/bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="../css/bootstrap-datetimepicker.min.css" />
    <link rel="stylesheet" href="../layui/css/layui.css" />
    <link rel="stylesheet" type="text/css" href="../css/style.css" />
    <link rel="stylesheet" href="../lookpic/dist/zoomify.min.css" />
    <script src="../js/jquery-3.1.1.min.js" type="text/javascript"></script>
    <script src="../js/bootstrap.min.js" type="text/javascript"></script>
    <script src="../js/dropdown.js" type="text/javascript"></script>
    <script src="../js/modal.js" type="text/javascript"></script>
    <!--<script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=3LSsiAvyTOStAaAc4Nwb2EDyZcUc9lx8"></script>-->
    <script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=NfeFkeBXjyXsHYMsfGPu4V6M4UMkCtFB"></script>
    <script type="text/javascript" src="../layui/layui.js"></script>
    <script src="../lookpic/dist/zoomify.min.js"></script>
    <script type="text/javascript" src="../js/jquery.bootstrap.min.js"></script>
    <style>
        .datetimepicker {
            margin-top: 50px !important;
        }

        .shouxupic img {
            width: 133px;
            height: 77px;
        }

        .bigca, .smallca {
            display: none;
        }
    </style>
    <title>车报废管理后台</title>
    <script type="text/javascript">
        //$('.dropdown-toggle').dropdown()
    </script>
</head>
<body>
    <div class="back-stage-top">
        <h1 class="pull-left">车报废管理后台</h1>
        <h1 class="pull-right text-primary" id="loginout" style="margin-left:20px;cursor:pointer;font-size:18px;margin-right:50px;" onclick="loginout()">退出</h1>
        <h1 class="pull-right text-primary" id="loginusername" style="margin-left:20px;font-size:18px;">用户名：张三</h1>
    </div>
    <div class="backnav">
        <ul class="backnav">
            <li><a href="index.html">首页</a></li>
            <li class="cur"><a href="orderlist.html">订单管理</a></li>
            <li><a href="scraplist.html">报废汽车</a></li>
            <li><a href="jiulist.html">旧件回收</a></li>
            <li><a href="moneymanage.html">财务管理</a></li>
            <li><a href="system.html">系统设置</a></li>
        </ul>
    </div>
    <div class="tablebox">
        <ol class="breadcrumb m-t-10">
            <li><a href="index.html">首页</a></li>
            <li><a href="orderlist.html">订单管理</a></li>
            <li>订单处理</li>
        </ol>
        <!--车辆信息-->
        <h2 class="text-center ordnum"></h2>
        <input type="hidden" id="clid" />
        <input type="hidden" class="carbao" />
        <div class="col-md-6">
            <h4 class="page-header"><span class="glyphicon glyphicon-list-alt m-l-15"></span> 车辆信息</h4>
            <table class="tablelist">
                <tr>
                    <th width="120" class="text-right"><span class="redcolor">*</span>车牌号：</th>
                    <td><input class="form-control carnum" placeholder="" type="text" /></td>
                </tr>
                <tr>
                    <th width="120" class="text-right"><span class="redcolor">*</span>车架号：</th>
                    <td><input class="form-control carjia" placeholder="" type="text" /></td>
                </tr>
                <tr>
                    <th width="120" class="text-right"><span class="redcolor">*</span>车辆型号：</th>
                    <td><input class="form-control carxing" disabled="disabled" placeholder="" type="text" /></td>
                </tr>
                <tr>
                    <th width="120" class="text-right"><span class="redcolor">*</span>能否行驶：</th>
                    <td>
                        <label class="m-r-10">
                            <input type="radio" name="travel" value="1" checked="checked" /> 可以行驶
                        </label>
                        <label class="m-r-10">
                            <input type="radio" name="travel" value="2" /> 不可以行驶
                        </label>
                        <label>
                            <input type="radio" name="travel" value="3" /> 严重事故
                        </label>
                    </td>
                </tr>
                <tr>
                    <th width="120" class="text-right"><span class="redcolor">*</span>车辆归属：</th>
                    <td>
                        <label class="m-r-10">
                            <input type="radio" name="belongto" value="1" checked="checked" /> 个人
                        </label>
                        <label class="m-r-10">
                            <input type="radio" name="belongto" value="2" /> 公户
                        </label>
                    </td>
                </tr>
                <tr>
                    <th width="120" class="text-right"><span class="redcolor">*</span>车主姓名：</th>
                    <td><input class="form-control" id="carOwner" placeholder="" type="text" /></td>
                </tr>
            </table>
        </div>
        <!--end 车辆信息-->
        <!--取车信息-->
        <div class="col-md-6">
            <h4 class="page-header"><span class="glyphicon glyphicon-list-alt m-l-15"></span> 取车信息</h4>
            <table class="tablelist">
                <tr>
                    <th width="120" class="text-right"><span class="redcolor">*</span>取车联系人：</th>
                    <td>
                        <div class="input-group">
                            <input type="text" id="changren" class="form-control" placeholder="" />
                            <span class="input-group-btn">
                                <button class="btn btn-default quan" type="button">常用联系人</button>
                            </span>
                        </div>
                    </td>
                </tr>
                <tr>
                    <th width="120" class="text-right"><span class="redcolor">*</span>联系人电话：</th>
                    <td><input class="form-control perphone" placeholder="" required="" autofocus="" type="text" /></td>
                </tr>

                <tr>
                    <th width="120" class="text-right"><span class="redcolor">*</span>取车时间：</th>
                    <td>
                        <div class="input-group">
                            <input type="text" class="form-control" id="checktime" placeholder="00-00-00" />
                            <!--<span role="button"  class="input-group-addon"><span class="glyphicon glyphicon-calendar"></span></span>-->
                        </div>
                    </td>
                </tr>
                <tr>
                    <th width="120" class="text-right"><span class="redcolor">*</span>取车地址：</th>
                    <td>
                        <input class="form-control setmap" placeholder="" required="" autofocus="" type="text" />
                    </td>
                </tr>
            </table>
        </div>
        <!--end 取车信息-->
        <div class="clearfix"></div>

        <div class="col-md-12">
            <h4 class="page-header"><span class="glyphicon glyphicon-list-alt m-l-15"></span> 车辆与手续照片</h4>
            <table class="tablelist">
                <tr>
                    <td>
                        <div class="row m-r-20 shouxupic">
                            <div class="col-xs-2 col-md-2 m-b-20">
                                <div class="thumbnail img-input-box  addpic">
                                    <img src="../img/addimg-bg.png" alt="" onclick="addactpic(0)" />
                                    <span class="delpic"></span>
                                    <input type="hidden" class="hiddenpicid" value="" />
                                    <span class="bigca">1</span>
                                    <span class="smallca">1</span>
                                    <form enctype="multipart/form-data" method="post">
                                        <input style="display: none;" type="file" multiple="multiple" accept=".png,.jpg,.jpeg,.gif,.PNG,.JPG,.JPEG,.GIF" name="upload" class="upload2" onchange="doUpload2(0)" />
                                    </form>
                                </div>
                                <p class="text-center">左前45度</p>
                            </div>
                            <div class="col-xs-2 col-md-2 m-b-20">
                                <div class="thumbnail img-input-box addpic">
                                    <img src="../img/addimg-bg.png" alt="" onclick="addactpic(1)" />
                                    <span class="delpic"></span>
                                    <input type="hidden" class="hiddenpicid" value="" />
                                    <span class="bigca">1</span>
                                    <span class="smallca">2</span>
                                    <form enctype="multipart/form-data" method="post">
                                        <input style="display: none;" type="file" multiple="multiple" accept=".png,.jpg,.jpeg,.gif,.PNG,.JPG,.JPEG,.GIF" name="upload" class="upload2" onchange="doUpload2(1)" />
                                    </form>
                                </div>
                                <p class="text-center">正前</p>
                            </div>
                            <div class="col-xs-2 col-md-2 m-b-20">
                                <div class="thumbnail img-input-box addpic">
                                    <img src="../img/addimg-bg.png" alt="" onclick="addactpic(2)" />
                                    <span class="delpic"></span>
                                    <input type="hidden" class="hiddenpicid" value="" />
                                    <span class="bigca">1</span>
                                    <span class="smallca">3</span>
                                    <form enctype="multipart/form-data" method="post">
                                        <input style="display: none;" type="file" multiple="multiple" accept=".png,.jpg,.jpeg,.gif,.PNG,.JPG,.JPEG,.GIF" name="upload" class="upload2" onchange="doUpload2(2)" />
                                    </form>
                                </div>
                                <p class="text-center">右前45度</p>
                            </div>
                            <div class="col-xs-2 col-md-2 m-b-20">
                                <div class="thumbnail img-input-box addpic">
                                    <img src="../img/addimg-bg.png" alt="" onclick="addactpic(3)" />
                                    <span class="delpic"></span>
                                    <input type="hidden" class="hiddenpicid" value="" />
                                    <span class="bigca">1</span>
                                    <span class="smallca">4</span>
                                    <form enctype="multipart/form-data" method="post">
                                        <input style="display: none;" type="file" multiple="multiple" accept=".png,.jpg,.jpeg,.gif,.PNG,.JPG,.JPEG,.GIF" name="upload" class="upload2" onchange="doUpload2(3)" />
                                    </form>
                                </div>
                                <p class="text-center">左后45度</p>
                            </div>
                            <div class="col-xs-2 col-md-2 m-b-20">
                                <div class="thumbnail img-input-box addpic">
                                    <img src="../img/addimg-bg.png" alt="" onclick="addactpic(4)" />
                                    <span class="delpic"></span>
                                    <input type="hidden" class="hiddenpicid" value="" />
                                    <span class="bigca">1</span>
                                    <span class="smallca">5</span>
                                    <form enctype="multipart/form-data" method="post">
                                        <input style="display: none;" type="file" multiple="multiple" accept=".png,.jpg,.jpeg,.gif,.PNG,.JPG,.JPEG,.GIF" name="upload" class="upload2" onchange="doUpload2(4)" />
                                    </form>
                                </div>
                                <p class="text-center">正后</p>
                            </div>
                            <div class="col-xs-2 col-md-2 m-b-20">
                                <div class="thumbnail img-input-box addpic">
                                    <img src="../img/addimg-bg.png" alt="" onclick="addactpic(5)" />
                                    <span class="delpic"></span>
                                    <input type="hidden" class="hiddenpicid" value="" />
                                    <span class="bigca">1</span>
                                    <span class="smallca">6</span>
                                    <form enctype="multipart/form-data" method="post">
                                        <input style="display: none;" type="file" multiple="multiple" accept=".png,.jpg,.jpeg,.gif,.PNG,.JPG,.JPEG,.GIF" name="upload" class="upload2" onchange="doUpload2(5)" />
                                    </form>
                                </div>
                                <p class="text-center">右后45度</p>
                            </div>
                            <div class="col-xs-2 col-md-2 m-b-20">
                                <div class="thumbnail img-input-box addpic">
                                    <img src="../img/addimg-bg.png" alt="" onclick="addactpic(6)" />
                                    <span class="delpic"></span>
                                    <input type="hidden" class="hiddenpicid" value="" />
                                    <span class="bigca">1</span>
                                    <span class="smallca">7</span>
                                    <form enctype="multipart/form-data" method="post">
                                        <input style="display: none;" type="file" multiple="multiple" accept=".png,.jpg,.jpeg,.gif,.PNG,.JPG,.JPEG,.GIF" name="upload" class="upload2" onchange="doUpload2(6)" />
                                    </form>
                                </div>
                                <p class="text-center">车架号</p>
                            </div>
                            <div class="col-xs-2 col-md-2 m-b-20">
                                <div class="thumbnail img-input-box addpic">
                                    <img src="../img/addimg-bg.png" alt="" onclick="addactpic(7)" />
                                    <span class="delpic"></span>
                                    <input type="hidden" class="hiddenpicid" value="" />
                                    <span class="bigca">1</span>
                                    <span class="smallca">8</span>
                                    <form enctype="multipart/form-data" method="post">
                                        <input style="display: none;" type="file" multiple="multiple" accept=".png,.jpg,.jpeg,.gif,.PNG,.JPG,.JPEG,.GIF" name="upload" class="upload2" onchange="doUpload2(7)" />
                                    </form>
                                </div>
                                <p class="text-center">发动机</p>
                            </div>
                            <div class="col-xs-2 col-md-2 m-b-20">
                                <div class="thumbnail img-input-box addpic">
                                    <img src="../img/addimg-bg.png" alt="" onclick="addactpic(8)" />
                                    <span class="delpic"></span>
                                    <input type="hidden" class="hiddenpicid" value="" />
                                    <span class="bigca">1</span>
                                    <span class="smallca">9</span>
                                    <form enctype="multipart/form-data" method="post">
                                        <input style="display: none;" type="file" multiple="multiple" accept=".png,.jpg,.jpeg,.gif,.PNG,.JPG,.JPEG,.GIF" name="upload" class="upload2" onchange="doUpload2(8)" />
                                    </form>
                                </div>
                                <p class="text-center">仪表</p>
                            </div>
                            <div class="col-xs-2 col-md-2 m-b-20">
                                <div class="thumbnail img-input-box addpic">
                                    <img src="../img/addimg-bg.png" alt="" onclick="addactpic(9)" />
                                    <span class="delpic"></span>
                                    <input type="hidden" class="hiddenpicid" value="" />
                                    <span class="bigca">2</span>
                                    <span class="smallca">10</span>
                                    <form enctype="multipart/form-data" method="post">
                                        <input style="display: none;" type="file" multiple="multiple" accept=".png,.jpg,.jpeg,.gif,.PNG,.JPG,.JPEG,.GIF" name="upload" class="upload2" onchange="doUpload2(9)" />
                                    </form>
                                </div>
                                <p class="text-center">行驶证</p>
                            </div>
                            <div class="col-xs-2 col-md-2 m-b-20">
                                <div class="thumbnail img-input-box addpic">
                                    <img src="../img/addimg-bg.png" alt="" onclick="addactpic(10)" />
                                    <span class="delpic"></span>
                                    <input type="hidden" class="hiddenpicid" value="" />
                                    <span class="bigca">2</span>
                                    <span class="smallca">11</span>
                                    <form enctype="multipart/form-data" method="post">
                                        <input style="display: none;" type="file" multiple="multiple" accept=".png,.jpg,.jpeg,.gif,.PNG,.JPG,.JPEG,.GIF" name="upload" class="upload2" onchange="doUpload2(10)" />
                                    </form>
                                </div>
                                <p class="text-center">登记台</p>
                            </div>
                            <div class="col-xs-2 col-md-2 m-b-20">
                                <div class="thumbnail img-input-box addpic">
                                    <img src="../img/addimg-bg.png" alt="" onclick="addactpic(11)" />
                                    <span class="delpic"></span>
                                    <input type="hidden" class="hiddenpicid" value="" />
                                    <span class="bigca">2</span>
                                    <span class="smallca">12</span>
                                    <form enctype="multipart/form-data" method="post">
                                        <input style="display: none;" type="file" multiple="multiple" accept=".png,.jpg,.jpeg,.gif,.PNG,.JPG,.JPEG,.GIF" name="upload" class="upload2" onchange="doUpload2(11)" />
                                    </form>
                                </div>
                                <p class="text-center">车主身份证正前方</p>
                            </div>
                            <div class="col-xs-2 col-md-2 m-b-20">
                                <div class="thumbnail img-input-box addpic">
                                    <img src="../img/addimg-bg.png" alt="" onclick="addactpic(12)" />
                                    <span class="delpic"></span>
                                    <input type="hidden" class="hiddenpicid" value="" />
                                    <span class="bigca">2</span>
                                    <span class="smallca">13</span>
                                    <form enctype="multipart/form-data" method="post">
                                        <input style="display: none;" type="file" multiple="multiple" accept=".png,.jpg,.jpeg,.gif,.PNG,.JPG,.JPEG,.GIF" name="upload" class="upload2" onchange="doUpload2(12)" />
                                    </form>
                                </div>
                                <p class="text-center">车主身份证正后</p>
                            </div>
                        </div>
                    </td>
                </tr>
            </table>
        </div>
        <!--残值发放信息-->
        <div class="col-md-6">
            <h4 class="page-header"><span class="glyphicon glyphicon-list-alt m-l-15"></span> 残值发放信息</h4>
            <table class="tablelist">
                <tr>
                    <th width="120" class="text-right"><span class="redcolor">*</span>收款人姓名：</th>
                    <td>
                        <div class="input-group">
                            <input class="form-control" id="payeeName" placeholder="" required="" autofocus="" type="text" />
                            <span class="input-group-btn">
                                <button class="btn btn-default shoukuanbtn" type="button" data-toggle="modal" data-target="#shoukuan">常用收款账户</button>
                            </span>
                        </div>
                    </td>
                </tr>
                <tr>
                    <th width="120" class="text-right"><span class="redcolor">*</span>银行账户：</th>
                    <td><input class="form-control" id="bankAccount" placeholder="" required="" autofocus="" type="text" /></td>
                </tr>
                <tr>
                    <th width="120" class="text-right"><span class="redcolor">*</span>开户行：</th>
                    <td><input class="form-control" id="openingBank" placeholder="" required="" autofocus="" type="text" /></td>
                </tr>
            </table>
        </div>
        <!--end 残值发放信息-->
        <!--手续邮寄信息-->
        <div class="col-md-6">
            <h4 class="page-header"><span class="glyphicon glyphicon-list-alt m-l-15"></span> 手续邮寄信息</h4>
            <table class="tablelist">
                <tr>
                    <th width="120" class="text-right"><span class="redcolor">*</span>收件人姓名：</th>
                    <td>
                        <div class="input-group">
                            <input class="form-control" placeholder="" id="mailingAddressName" required="" autofocus="" type="text" />
                            <span class="input-group-btn">
                                <button class="btn btn-default shoujianbtn" type="button" data-toggle="modal" data-target="#shoujian">常用收件人</button>
                            </span>
                        </div>
                    </td>
                </tr>
                <tr>
                    <th width="120" class="text-right"><span class="redcolor">*</span>收件人电话：</th>
                    <td><input class="form-control" placeholder="" required="" id="mailingAddressTelephone" autofocus="" type="text" /></td>
                </tr>
                <tr>
                    <th width="120" class="text-right"><span class="redcolor">*</span>邮寄地址：</th>
                    <td>
                        <div class="pull-left m-r-10">
                            <select class="form-control" id="provinceselect">
                                <option value="">--请选择--</option>
                            </select>
                        </div>
                        <div class="pull-left m-r-10">
                            <select class="form-control" id="cityselect">
                                <option value="">--请选择--</option>
                            </select>
                        </div>
                        <div class="pull-left">
                            <select class="form-control" id="levelselect">
                                <option value="">--请选择--</option>
                            </select>
                        </div>
                    </td>
                </tr>
                <tr>
                    <th width="120" class="text-right"></th>
                    <td><input class="form-control" placeholder="详细地址" id="detailedAddress" required="" autofocus="" type="text" /></td>
                </tr>
            </table>
        </div>
        <!--end 手续邮寄信息-->
        <div class="col-md-12">
            <h4 class="page-header"><span class="glyphicon glyphicon-list-alt m-l-15"></span> 派单信息</h4>
            <table class="tablelist">
                <tr>
                    <th width="120" class="text-right"><span class="redcolor">*</span>业务员：</th>
                    <td>
                        <select class="form-control" id="userselect"></select>
                    </td>
                </tr>
                <tr>
                    <th width="120" class="text-right">派单备注：</th>
                    <td><textarea class="form-control" rows="3" id="auditRemark"></textarea></td>
                </tr>
            </table>
        </div>
        <div class="clearfix page-header p-tb30"></div>
        <div class="text-center m-b-20">
            <button class="btn btn-primary btn-lg m-r-10" onclick="yichangClick()">异常订单</button>
            <button class="btn btn-primary btn-lg m-r-10 zancun">暂存</button>
            <button class="btn btn-primary btn-lg paidan">派单</button>
        </div>
    </div>
    <!-- 常用联系人 -->
    <div class="hide">
        <div id="detailState">
            <table class="table table-striped addren">
                <thead><tr><th width="200">姓名</th><th>电话</th></tr></thead>
                <tbody></tbody>
            </table>
        </div>
    </div>
    <!-- 常用收款账户 -->
    <div class="hide">
        <div id="shoukuandetail">
            <table class="table table-striped addshoukuan">
                <thead><tr><th width="200">收款人姓名</th><th>银行账户</th><th>开户行</th></tr></thead>
                <tbody></tbody>
            </table>
        </div>
    </div>
    <!-- 常用收件人 -->
    <div class="hide">
        <div id="shoujiandetail">
            <table class="table table-striped addshoujian">
                <thead>
                    <tr>
                        <th style="width:90px;">收件人姓名</th>
                        <th style="width:90px;">收件人电话</th>
                        <th style="width:80px;">省份</th>
                        <th style="width:80px;">城市</th>
                        <th style="width:80px;">区域</th>
                        <th style="width:150px;">详细地址</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>
    <!-- 地图 -->
    <div class="hide">
        <input type="hidden" id="coordinate" />
        <div id="showmap" style="z-index:999;">
            <table>
                <tr>
                    <td>
                        <input type="text" id="suggestId" name="Locality" value="" class="form-control"
                               required=required placeholder="请输入车辆所在位置" maxlength="20" style="width:350px;" />
                        <div id="searchResultPanel" style="border:1px solid #C0C0C0;width:150px;height:auto; display:none;z-index:1000;"></div>
                        <div id="l-map" style="width:535px;height:305px;margin-top:10px;margin-left:10px;"></div>


                    </td>
                    <td style="width: 10px;"></td>
                </tr>
            </table>
            <br />
            <div id="allmap"></div>
        </div>
    </div>
    <div class="hide">
        <div id="paidan">
            确定派单吗？
        </div>
    </div>
    <div class="hide">
        <div id="yidan">
            确定为异常订单吗？
        </div>
    </div>
    <div class="hide">
        <div id="zancun">
            暂存订单吗？
        </div>
    </div>
    <script src="../js/bootstrap-datetimepicker.min.js"></script>
    <script src="../js/bootstrap-datetimepicker.zh-CN.js"></script>
    <script src="../js/comm.js"></script>
    <script>
        (function ($) {
            $.getUrlParam = function (name) {
                var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
                var r = window.location.search.substr(1).match(reg);
                if (r != null) return unescape(r[2]);
                return null;
            }
        })(jQuery);
        var id = $.getUrlParam('id');
        $("#clid").val(id);
        layui.use('layer', function () {

        });
        //派单
        function paiClick() {
            var formData = new FormData();
            console.log("URL:" + href + 'order/audit/' + id)
            console.log("data:" + JSON.stringify({
                id: id,
                auditorderStatus: 2,
                auditRemark: $("#auditRemark").val(),
                agentUserid: $("#userselect option:selected").val(),
                carNumber: $(".carnum").val(),
                carFrameNumber: $(".carjia").val(),
                carModelNumber: $(".carxing").val(),
                reportNo: $(".carbao").val(),
                takeCarContacts: $("#changren").val(),
                takeCarContactNumber: $(".perphone").val(),
                takeCarTime: $("#checktime").val(),
                takeCarAddress: $(".setmap").val()
            }));

            //console.log("URL:" + href + 'order/audit/' + id)
            $.ajax({
                type: "PUT",
                url: href + 'order/audit/' + id,
                dataType: "json",
                data: {
                    id: id,
                    auditorderStatus: 2,
                    auditRemark: $("#auditRemark").val(),
                    agentUserid: $("#userselect option:selected").val(),
                    carNumber: $(".carnum").val(),
                    carFrameNumber: $(".carjia").val(),
                    carModelNumber: $(".carxing").val(),
                    reportNo: $(".carbao").val(),
                    takeCarContacts: $("#changren").val(),
                    takeCarContactNumber: $(".perphone").val(),
                    takeCarTime: $("#checktime").val(),
                    takeCarAddress: $(".setmap").val()
                },
                success: function (obj) {
                    console.log("obj:" + JSON.stringify(obj));
                    if (obj.msg == "success") {
                        var info = obj.data;
                        layer.msg('<span style="font-size:20px">操作成功</span>', {
                            time: 1000, //2s后自动关闭
                        }, function () {
                            window.location.href = "orderlist.html";
                        });
                    } else {
                        layer.msg('<span style="font-size:20px">操作失败</span>', {
                            time: 1000, //2s后自动关闭
                        }, function () {
                            window.location.href = "orderlist.html";
                        });
                    }
                }
            })
        }
        $(document).delegate('.paidan', 'click', function (event) {
            event.preventDefault();
            $('#paidan').dialog({
                title: '派单',
                onClose: function () {
                    $(this).dialog('close');
                },
                buttons: [{
                    text: '取消',
                    'click': function () {
                        $(this).dialog('close');
                    }
                }, {
                    text: '确定',
                    'class': 'btn-primary',
                    'click': function () {
                        paiClick();
                    }
                }]
            })
        });
        //绑定业务员
        function BindUser(businessType, areaid, def) {
            //console.log("def：" + def);
            //console.log("URL:" + href + '/user/queryReceiveUser?businessType=' + businessType + '&areaid=' + areaid)
            $.ajax({
                type: "get",
                url: href + 'user/queryReceiveUser?businessType=' + businessType + '&areaid=' + areaid,
                dataType: "json",
                success: function (obj) {
                    //console.log("obj:" + JSON.stringify(obj));
                    if (obj.msg == "success") {
                        var info = obj.data;
                        var otr = "";
                        for (var i = 0, j = info.length; i < j; i++) {
                            if (def == info[i].realName) {
                                $("#userselect").append("<option selected value=" + info[i].id + ">" + info[i].realName + "</option>");
                            } else {
                                $("#userselect").append("<option value=" + info[i].id + ">" + info[i].realName + "</option>");
                            }

                        };
                    }
                    //$("#userselect").val(def);
                    //$("#userselect").find("option[text='" + def + "']").attr("selected", true);

                }
            })
        }

        //整车订单暂存
        function zancunClick() {
            $.ajax({
                type: "put",
                url: href + 'order/' + id,
                data: {
                    carNumber: $(".carnum").val(),
                    carFrameNumber: $(".carjia").val(),
                    carModelNumber: $(".carxing").val(),
                    isdrive: $(":radio[name=travel]:checked").val(),
                    carAscription: $(":radio[name=belongto]:checked").val(),
                    carOwner: $("#carOwner").val(),
                    takeCarContacts: $("#changren").val(),
                    takeCarContactNumber: $(".perphone").val(),
                    takeCarTime: $("#checktime").val(),
                    takeCarAddress: $(".setmap").val(),
                    coordinate: $("#coordinate").val(),
                    payeeName: $("#payeeName").val(),
                    bankAccount: $("#bankAccount").val(),
                    openingBank: $("#openingBank").val(),
                    mailingAddressName: $("#mailingAddressName").val(),
                    mailingAddressTelephone: $("#mailingAddressTelephone").val(),
                    province: $("#provinceselect option:selected").val(),
                    city: $("#cityselect option:selected").val(),
                    county: $("#levelselect option:selected").val(),
                    detailedAddress: $("#detailedAddress").val(),
                    agentUserid: $("#userselect option:selected").val(),
                    auditRemark: $("#auditRemark").val()
                },
                dataType: "json",
                success: function (obj) {
                    if (obj.msg == "success") {
                        if (obj.data) {
                            layer.msg('<span style="font-size:20px">暂存成功</span>', {
                                time: 1000, //2s后自动关闭
                            }, function () {
                                window.location.href = "orderlist.html";
                            });
                        }
                    }
                }
            });
        }
        $(document).delegate('.zancun', 'click', function (event) {
            event.preventDefault();
            $('#zancun').dialog({
                title: '暂存',
                onClose: function () {
                    $(this).dialog('close');
                },
                buttons: [{
                    text: '取消',
                    'click': function () {
                        $(this).dialog('close');
                    }
                }, {
                    text: '确定',
                    'class': 'btn-primary',
                    'click': function () {
                        zancunClick();
                    }
                }]
            })
        });

        //异常订单处理
        function yichangClick() {
            console.log($("#checktime").val());
            var r = confirm("您确定此单为异常订单吗？");
            if (r == true) {
                $.ajax({
                    type: "put",
                    url: href + 'order/audit/' + id,
                    data: {
                        auditorderStatus: "8",
                        carNumber: $(".carnum").val(),
                        carFrameNumber: $(".carjia").val(),
                        carModelNumber: $(".carxing").val(),
                        reportNo: $(".carbao").val(),
                        isdrive: $(":radio[name=travel]:checked").val(),
                        carAscription: $(":radio[name=belongto]:checked").val(),
                        carOwner: $("#carOwner").val(),
                        takeCarContacts: $("#changren").val(),
                        takeCarContactNumber: $(".perphone").val(),
                        takeCarTime: $("#checktime").val(),
                        takeCarAddress: $(".setmap").val(),
                        coordinate: $("#coordinate").val(),
                        payeeName: $("#payeeName").val(),
                        bankAccount: $("#bankAccount").val(),
                        openingBank: $("#openingBank").val(),
                        mailingAddressName: $("#mailingAddressName").val(),
                        mailingAddressTelephone: $("#mailingAddressTelephone").val(),
                        province: $("#provinceselect option:selected").val(),
                        city: $("#cityselect option:selected").val(),
                        county: $("#levelselect option:selected").val(),
                        detailedAddress: $("#detailedAddress").val(),
                        expressCompany: "",
                        expressNumber: "",
                        agentUserid: $("#userselect option:selected").val(),
                        auditRemark: $("#auditRemark").val()
                    },
                    dataType: "json",
                    success: function (obj) {
                        console.log(obj);
                        if (obj.msg == "success") {
                            if (obj.data) {
                                layer.msg('<span style="font-size:20px">异常订单保存成功</span>', {
                                    time: 1000, //2s后自动关闭
                                }, function () {
                                    window.location.href = "orderlist.html";
                                });
                            }
                        }
                    }
                });
            }
        }

        LoadProvinces();
        //加载详情
        $.ajax({
            type: "get",
            url: href + 'order/' + id,
            dataType: "json",
            success: function (data) {
                //console.log("obj:" + JSON.stringify(data));
                if (data.msg == "success") {
                    var d = data.data;
                    console.log(d);
                    $(".ordnum").html("订单信息:" + d.orderNo);
                    $(".carnum").val(d.carNumber);
                    $(".carjia").val(d.carFrameNumber);
                    $(".carxing").val(d.carModelNumber);
                    $(".carbao").val(d.reportNo);
                    $("#carOwner").val(d.carOwner);
                    $("#changren").val(d.takeCarContacts);
                    $(".perphone").val(d.takeCarContactNumber);
                    $("#checktime").val(d.takeCarTime);
                    $(".setmap").val(d.takeCarAddress);
                    $("#auditRemark").val(d.auditRemark);
                    $("#coordinate").val(d.coordinate);
                    $(":radio[name='travel'][value=" + d.isdrive + "]").prop("checked", "checked");
                    $(":radio[name='belongto'][value='" + d.carAscription + "']").prop("checked", "checked");
                    //加载车辆照片
                    var pics = d.vehiclePictures;
                    for (i = 0; i < pics.length; i++) {
                        if (pics[i].carPictureType == "1") {
                            $(".addpic").eq(0).children("img").attr("src", pics[i].url);
                            $(".addpic").eq(0).children(".hiddenpicid").val(pics[i].id);
                            var delinfo = '<button type="button" class="del-btn" onclick="del(this,' + pics[i].id + ')"><span class="glyphicon glyphicon-remove"></span></button>';
                            $(".addpic").eq(0).children(".delpic").html(delinfo);
                        }
                        if (pics[i].carPictureType == "2") {
                            $(".addpic").eq(1).children("img").attr("src", pics[i].url);
                            $(".addpic").eq(1).children(".hiddenpicid").val(pics[i].id);
                            var delinfo = '<button type="button" class="del-btn" onclick="del(this,' + pics[i].id + ')"><span class="glyphicon glyphicon-remove"></span></button>';
                            $(".addpic").eq(1).children(".delpic").html(delinfo);
                        }
                        if (pics[i].carPictureType == "3") {
                            $(".addpic").eq(2).children("img").attr("src", pics[i].url);
                            $(".addpic").eq(2).children(".hiddenpicid").val(pics[i].id);
                            var delinfo = '<button type="button" class="del-btn" onclick="del(this,' + pics[i].id + ')"><span class="glyphicon glyphicon-remove"></span></button>';
                            $(".addpic").eq(2).children(".delpic").html(delinfo);
                        }
                        if (pics[i].carPictureType == "4") {
                            $(".addpic").eq(3).children("img").attr("src", pics[i].url);
                            $(".addpic").eq(3).children(".hiddenpicid").val(pics[i].id);
                            var delinfo = '<button type="button" class="del-btn" onclick="del(this,' + pics[i].id + ')"><span class="glyphicon glyphicon-remove"></span></button>';
                            $(".addpic").eq(3).children(".delpic").html(delinfo);
                        }
                        if (pics[i].carPictureType == "5") {
                            $(".addpic").eq(4).children("img").attr("src", pics[i].url);
                            $(".addpic").eq(4).children(".hiddenpicid").val(pics[i].id);
                            var delinfo = '<button type="button" class="del-btn" onclick="del(this,' + pics[i].id + ')"><span class="glyphicon glyphicon-remove"></span></button>';
                            $(".addpic").eq(4).children(".delpic").html(delinfo);
                        }
                        if (pics[i].carPictureType == "6") {
                            $(".addpic").eq(5).children("img").attr("src", pics[i].url);
                            $(".addpic").eq(5).children(".hiddenpicid").val(pics[i].id);
                            var delinfo = '<button type="button" class="del-btn" onclick="del(this,' + pics[i].id + ')"><span class="glyphicon glyphicon-remove"></span></button>';
                            $(".addpic").eq(5).children(".delpic").html(delinfo);
                        }
                        if (pics[i].carPictureType == "7") {
                            $(".addpic").eq(6).children("img").attr("src", pics[i].url);
                            $(".addpic").eq(6).children(".hiddenpicid").val(pics[i].id);
                            var delinfo = '<button type="button" class="del-btn" onclick="del(this,' + pics[i].id + ')"><span class="glyphicon glyphicon-remove"></span></button>';
                            $(".addpic").eq(6).children(".delpic").html(delinfo);
                        }
                        if (pics[i].carPictureType == "8") {
                            $(".addpic").eq(7).children("img").attr("src", pics[i].url);
                            $(".addpic").eq(7).children(".hiddenpicid").val(pics[i].id);
                            var delinfo = '<button type="button" class="del-btn" onclick="del(this,' + pics[i].id + ')"><span class="glyphicon glyphicon-remove"></span></button>';
                            $(".addpic").eq(7).children(".delpic").html(delinfo);
                        }
                        if (pics[i].carPictureType == "9") {
                            $(".addpic").eq(8).children("img").attr("src", pics[i].url);
                            $(".addpic").eq(8).children(".hiddenpicid").val(pics[i].id);
                            var delinfo = '<button type="button" class="del-btn" onclick="del(this,' + pics[i].id + ')"><span class="glyphicon glyphicon-remove"></span></button>';
                            $(".addpic").eq(8).children(".delpic").html(delinfo);
                        }
                    }
                    //加载手续照片
                    pics = d.formalitiesPictures;
                    pic1info = "";
                    for (i = 0; i < pics.length; i++) {
                        if (pics[i].carPictureType == "10") {
                            $(".addpic").eq(9).children("img").attr("src", pics[i].url);
                            $(".addpic").eq(9).children(".hiddenpicid").val(pics[i].id);
                            var delinfo = '<button type="button" class="del-btn" onclick="del(this,' + pics[i].id + ')"><span class="glyphicon glyphicon-remove"></span></button>';
                            $(".addpic").eq(9).children(".delpic").html(delinfo);
                        }
                        if (pics[i].carPictureType == "11") {
                            $(".addpic").eq(10).children("img").attr("src", pics[i].url);
                            $(".addpic").eq(10).children(".hiddenpicid").val(pics[i].id);
                            var delinfo = '<button type="button" class="del-btn" onclick="del(this,' + pics[i].id + ')"><span class="glyphicon glyphicon-remove"></span></button>';
                            $(".addpic").eq(10).children(".delpic").html(delinfo);
                        }
                        if (pics[i].carPictureType == "12") {
                            $(".addpic").eq(11).children("img").attr("src", pics[i].url);
                            $(".addpic").eq(11).children(".hiddenpicid").val(pics[i].id);
                            var delinfo = '<button type="button" class="del-btn" onclick="del(this,' + pics[i].id + ')"><span class="glyphicon glyphicon-remove"></span></button>';
                            $(".addpic").eq(11).children(".delpic").html(delinfo);
                        }
                        if (pics[i].carPictureType == "13") {
                            $(".addpic").eq(12).children("img").attr("src", pics[i].url);
                            $(".addpic").eq(12).children(".hiddenpicid").val(pics[i].id);
                            var delinfo = '<button type="button" class="del-btn" onclick="del(this,' + pics[i].id + ')"><span class="glyphicon glyphicon-remove"></span></button>';
                            $(".addpic").eq(12).children(".delpic").html(delinfo);
                        }
                    }
                    ////初始化话图片
                    //$(".shouxupic img").zoomify();
                    $("#openingBank").val(d.openingBank);
                    $("#payeeName").val(d.payeeName);
                    $("#bankAccount").val(d.bankAccount);
                    $("#mailingAddressName").val(d.mailingAddressName);
                    $("#mailingAddressTelephone").val(d.mailingAddressTelephone);
                    $("#provinceselect").val(d.province);
                    $("#cityselect").val(d.city);
                    $("#detailedAddress").val(d.detailedAddress);
                    LoadCitys(d.province, d.city, d.county);
                    //pai(d.orderAreasId,"");
                    var dd = d.carScrapOrderAutopartsList;
                    if (dd.length) {
                        var otr = "";
                        for (var i = 0; i < dd.length; i++) {
                            otr += '<tr>'
                            otr += '<td>' + dd[i].partsCaregoryName + '</td>'
                            otr += '<td>' + dd[i].partsTypeName + '</td>'
                            otr += '<td>' + dd[i].partsNum + '</td>'
                            otr += '<td>' + dd[i].remark + '</td>';
                            var pics = dd[i].autoPartsPictures;
                            var obj = "";
                            var urls = [], ids = [];
                            if (pics.length) {
                                for (var j = 0; j < pics.length; j++) {
                                    //console.log(j)
                                    urls.push(pics[j].url);
                                    ids.push(pics[j].id)
                                    obj += '<div class="col-md-3 col-xs-6">'
                                    obj += '<div class="thumbnail"><img src="' + pics[j].url + '" /></div>'
                                    obj += '</div>'
                                }
                            };
                            var urrs = urls.join();
                            var idss = ids.join();
                            otr += '<td> <div class="row">' + obj + '</div></td>'
                            //                      otr += '<td>'+dd[i].amount+'</td>';
                            //                      otr += '<td>'+dd[i].receiveTime+'</td></tr>';
                            otr += '<td><a data-id="' + dd[i].id + '" data-ids="' + idss + '" data-url="' + urrs + '" data-bei="' + dd[i].remark + '" data-num="' + dd[i].partsNum + '" data-name="' + dd[i].partsType + '" data-lei="' + dd[i].partsCaregoryId + '" role="button" class="btn btn-default btn-sm bian"><span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>编辑 </a>'
                            otr += '</td></tr>'
                            //                    if(dd[i].orderStatus==1){
                            //                    otr += '<button data-id="'+dd[i].id+'" onclick="deldata(this)" type="button" class="btn btn-default btn-sm" ><span class="glyphicon glyphicon-remove" aria-hidden="true"></span>删除 </button></td></tr>'
                            //                      }else{
                            //                     otr += '</td></tr>'
                            //                      }

                        };
                        $(".addtab tbody").html(otr)
                    }
                    BindUser(1, d.orderAreasId, d.saleName);

                }
            }
        });

        //查询省份
        function LoadProvinces() {
            $.ajax({
                type: "get",
                url: href + 'dictionary/getAllProvince',
                dataType: "json",
                success: function (obj) {
                    if (obj.msg == "success") {
                        var info = obj.data;
                        var otr = "";
                        var province = $("#provinceselect");
                        for (var i = 0, j = info.length; i < j; i++) {
                            province.append("<option value=" + info[i].id + ">" + info[i].name + "</option>");
                        };
                    }
                }
            })
        }
        $("#provinceselect").change(function () {
            var selectvalue = $("#provinceselect option:selected").val();
            $("#cityselect").empty().append("<option value=''>--请选择--</option>");
            $("#levelselect").empty().append("<option value=''>--请选择--</option>");
            LoadCitys(selectvalue);
        });
        //根据省份查询市区
        function LoadCitys(x, id, lid) {
            var city = $("#cityselect");
            if (x) {
                $("#provinceselect").val(x);
                $.ajax({
                    type: "get",
                    url: href + 'dictionary/getAllCityByProvinceId/' + x,
                    dataType: "json",
                    success: function (obj) {
                        if (obj.msg == "success") {
                            var info = obj.data;
                            var otr = "";
                            for (var i = 0, j = info.length; i < j; i++) {
                                city.append("<option value=" + info[i].id + ">" + info[i].name + "</option>");
                            };
                            if (id) {
                                $("#cityselect").val(id);
                                LoadLevels(id, lid);
                            }
                        }
                    }
                })
            }
            else {
                city.empty();
                city.append("<option value=''>--请选择--</option>");
            }
        }
        $("#cityselect").change(function () {
            $("#levelselect").empty().append("<option value=''>--请选择--</option>");
            var selectvalue = $("#cityselect option:selected").val();
            LoadLevels($("#cityselect option:selected").val());
        });
        //根据市区查询县级地区
        function LoadLevels(x, lid) {
            var level = $("#levelselect");
            if (x) {
                $.ajax({
                    type: "get",
                    url: href + 'dictionary/getAllAreaByCityId/' + x,
                    dataType: "json",
                    success: function (obj) {
                        if (obj.msg == "success") {
                            var info = obj.data;
                            var otr = "";
                            for (var i = 0, j = info.length; i < j; i++) {
                                level.append("<option value=" + info[i].id + ">" + info[i].name + "</option>");
                            };
                            if (lid) {
                                $("#levelselect").val(lid);
                            }
                        }
                    }
                })
            }
            else {
                level.empty();
                level.append("<option value=''>--请选择--</option>");
            }
        }

        //加载图片所属类型
        function GetPicCategory(a) {
            var result = "";
            switch (a) {
                case "1": result = "左前45度"; break;
                case "2": result = "正前"; break;
                case "3": result = "右前45度 "; break;
                case "4": result = "左后45度"; break;
                case "5": result = "正后"; break;
                case "6": result = "右后45度"; break;
                case "7": result = "车架号"; break;
                case "8": result = "发动机"; break;
                case "9": result = "仪表"; break;
                case "10": result = "行驶证"; break;
                case "11": result = "登记台"; break;
                case "12": result = "车主身份正正前方"; break;
                case "13": result = "车主身份正正后"; break;
                default: result = "";
            }
            return result;
        }
        //常用联系人
        $(document).delegate('.quan', 'click', function (event) {
            event.preventDefault();
            $.ajax({
                type: "get",
                url: href + 'commonContacts?page=1&rows=10',
                dataType: "json",
                success: function (data) {
                    if (data.msg == "success") {
                        var d = data.data.rows;
                        var otr = "";
                        for (var i = 0; i < d.length; i++) {
                            otr += '<tr><td><input type="radio" name="con-per"  class="dancheck" >   ' + d[i].contactName + '</td><td>' + d[i].contactTelephone + '</td></tr>'
                        };
                        $(".addren tbody").html(otr)
                    }
                }
            })
            $('#detailState').dialog({
                title: '常用联系人',
                onClose: function () {
                    $(this).dialog('close');
                },
                buttons: [{
                    text: '取消',
                    'click': function () {
                        $(this).dialog('close');
                    }
                }, {
                    text: '确定',
                    'class': 'btn-primary',
                    'click': function () {
                        for (var i = 0; i < $(".dancheck").length; i++) {
                            if ($(".dancheck").eq(i).prop("checked") == true) {
                                $("#changren").val($(".dancheck").eq(i).parent().parent().find("td").eq(0).text());
                                $(".perphone").val($(".dancheck").eq(i).parent().parent().find("td").eq(1).text());
                            }
                        }
                        $('#detailState').dialog('close')
                    }
                }]
            })
        });

        //常用收款账户
        $(document).delegate('.shoukuanbtn', 'click', function (event) {
            event.preventDefault();
            $.ajax({
                type: "get",
                url: href + 'commonPayee?page=1&rows=10&clientid=2193674800c24d899d405b4c64f07412',
                dataType: "json",
                success: function (data) {
                    if (data.msg == "success") {
                        var d = data.data.rows;
                        var otr = "";
                        for (var i = 0; i < d.length; i++) {
                            otr += '<tr><td><input type="radio" name="con-per"  class="shoukuancheck" >' + d[i].payeeName + '</td><td>' + d[i].bankAccount + '</td><td>' + d[i].openingBank + '</td></tr>';
                        };
                        $(".addshoukuan tbody").html(otr)
                    }
                }
            })
            $('#shoukuandetail').dialog({
                title: '常用收款账户',
                onClose: function () {
                    $(this).dialog('close');
                },
                buttons: [{
                    text: '取消',
                    'click': function () {
                        $(this).dialog('close');
                    }
                }, {
                    text: '确定',
                    'class': 'btn-primary',
                    'click': function () {
                        for (var i = 0; i < $(".shoukuancheck").length; i++) {
                            if ($(".shoukuancheck").eq(i).prop("checked") == true) {
                                $("#payeeName").val($(".shoukuancheck").eq(i).parent().parent().find("td").eq(0).text());
                                $("#bankAccount").val($(".shoukuancheck").eq(i).parent().parent().find("td").eq(1).text());
                                $("#openingBank").val($(".shoukuancheck").eq(i).parent().parent().find("td").eq(2).text());
                            }
                        }
                        $('#shoukuandetail').dialog('close')
                    }
                }]
            })
        });

        //常用收件人
        $(document).delegate('.shoujianbtn', 'click', function (event) {
            event.preventDefault();
            $.ajax({
                type: "get",
                //url: href + 'commonMailing?page=1&rows=10&clientid=1453674800c24d899d405b4c64f07412',
                url: "http://60.205.223.142/carscraporder-manager/external/commonMailing?page=1&rows=10",
                dataType: "json",
                success: function (data) {
                    if (data.msg == "success") {
                        var d = data.data.rows;
                        var otr = "";
                        for (var i = 0; i < d.length; i++) {
                            otr += '<tr>';
                            otr += '<td><input type="radio" name="con-per"  class="shoujiancheck" >' + d[i].mailingAddressName + '</td>';
                            otr += '<td> ' + d[i].mailingAddressTelephone + '</td >';
                            otr += '<td>' + LoadProvince(d[i].province) + '<input type="hidden" value=' + d[i].province + ' /></td>';
                            otr += '<td>' + LoadCity(d[i].city) + '<input type="hidden" value=' + d[i].city + ' /></td>';
                            otr += '<td>' + LoadArea(d[i].county) + '<input type="hidden" value=' + d[i].county + ' /></td>';
                            otr += '<td>' + d[i].detailedAddress + '</td>';
                            otr += '</tr > ';
                        }
                        $(".addshoujian tbody").html(otr)
                    }
                }
            })
            $('#shoujiandetail').dialog({
                title: '常用收件人',
                onClose: function () {
                    $(this).dialog('close');
                },
                buttons: [{
                    text: '取消',
                    'click': function () {
                        $(this).dialog('close');
                    }
                }, {
                    text: '确定',
                    'class': 'btn-primary',
                    'click': function () {
                        for (var i = 0; i < $(".shoujiancheck").length; i++) {
                            if ($(".shoujiancheck").eq(i).prop("checked") == true) {
                                $("#mailingAddressName").val($(".shoujiancheck").eq(i).parent().parent().find("td").eq(0).text());
                                $("#mailingAddressTelephone").val($(".shoujiancheck").eq(i).parent().parent().find("td").eq(1).text());
                                var sheng = $(".shoujiancheck").eq(i).parent().parent().find("td").eq(2).find("input").val();
                                var shi = $(".shoujiancheck").eq(i).parent().parent().find("td").eq(3).find("input").val();
                                var qu = $(".shoujiancheck").eq(i).parent().parent().find("td").eq(4).find("input").val();
                                $("#detailedAddress").val($(".shoujiancheck").eq(i).parent().parent().find("td").eq(5).text());
                                //加载省市区
                                LoadCitys(sheng, shi, qu);
                            }
                        }
                        $('#shoujiandetail').dialog('close')
                    }
                }]
            })
        });

        //加载省份
        function LoadProvince(a) {
            var result = "";
            if (a) {
                $.ajax({
                    type: "get",
                    url: href + "provinces/" + a,
                    async: false,
                    dataType: "json",
                    success: function (obj) {
                        if (obj.msg == "success") {
                            if (obj.data) {
                                result += obj.data.province;
                            }
                        }
                    }
                });
            }
            return result;
        }
        //加载城市
        function LoadCity(b) {
            var result = "";
            if (b) {
                $.ajax({
                    type: "get",
                    url: href + "cityes/" + b,
                    dataType: "json",
                    async: false,
                    success: function (obj) {
                        if (obj.msg == "success") {
                            if (obj.data) {
                                result += obj.data.city;
                            }
                        }
                    }
                });
            }
            return result;
        }
        //加载区域
        function LoadArea(c) {
            var result = "";
            if (c) {
                $.ajax({
                    type: "get",
                    url: href + "areas/" + c,
                    dataType: "json",
                    async: false,
                    success: function (obj) {
                        if (obj.msg == "success") {
                            if (obj.data) {
                                result += obj.data.area;
                            }
                        }
                    }
                });
            }
            return result;
        }

        //选择时间
        $('#checktime').datetimepicker({
            format: 'yyyy-mm-dd hh:00:00',
            language: 'zh-CN',
            autoclose: 1,
            minView: "day",
            hoursDisabled: []
        });

        // 百度地图API功能
        function G(id) {
            return document.getElementById(id);
        }

        var map = new BMap.Map("l-map");
        map.setCurrentCity("北京");
        map.enableScrollWheelZoom();//启动鼠标滚轮缩放地图
        map.centerAndZoom(new BMap.Point(116.4136103013, 39.9110666857), 12);                // 初始化地图,设置城市和地图级别。
        map.enableScrollWheelZoom(true);     //开启鼠标滚轮缩放
        //单击获取点击的经纬度
        //map.addEventListener("click", function (e) {
        //    alert(e.point.lng + "," + e.point.lat);
        //});
        var geoc = new BMap.Geocoder();
        var ac = new BMap.Autocomplete(    //建立一个自动完成的对象
            {
                "input": "suggestId"
                , "location": map
            });
        map.addEventListener("click", function (e) {
            var pt = e.point;
            console.log(pt);
            $("#coordinate").val(pt.lng + "," + pt.lat);
            geoc.getLocation(pt, function (rs) {
                map.clearOverlays();
                map.addOverlay(new BMap.Marker(pt));
                var addComp = rs.addressComponents;
                $("#suggestId").val(addComp.province + ", " + addComp.city + ", " + addComp.district + ", " + addComp.street + ", " + addComp.streetNumber);

            });
        });
        console.log("ss");
        ac.addEventListener("onhighlight", function (e) {  //鼠标放在下拉列表上的事件
            var str = "";
            var _value = e.fromitem.value;
            var value = "";
            if (e.fromitem.index > -1) {
                value = _value.province + _value.city + _value.district + _value.street + _value.business;
            }
            str = "FromItem<br />index = " + e.fromitem.index + "<br />value = " + value;

            value = "";
            if (e.toitem.index > -1) {
                _value = e.toitem.value;
                value = _value.province + _value.city + _value.district + _value.street + _value.business;
            }
            str += "<br />ToItem<br />index = " + e.toitem.index + "<br />value = " + value;
            G("searchResultPanel").innerHTML = str;
        });

        var myValue;
        ac.addEventListener("onconfirm", function (e) {    //鼠标点击下拉列表后的事件
            var _value = e.item.value;
            myValue = _value.province + _value.city + _value.district + _value.street + _value.business;
            G("searchResultPanel").innerHTML = "onconfirm<br />index = " + e.item.index + "<br />myValue = " + myValue;
            setPlace();
        });

        function setPlace() {
            map.clearOverlays();    //清除地图上所有覆盖物
            function myFun() {
                var pp = local.getResults().getPoi(0).point;    //获取第一个智能搜索的结果
                map.centerAndZoom(pp, 18);
                map.addOverlay(new BMap.Marker(pp));    //添加标注
            }
            var local = new BMap.LocalSearch(map, { //智能搜索
                onSearchComplete: myFun
            });
            local.search(myValue);
        }

        //点击打开地图
        $(document).delegate('.setmap', 'click', function (event) {
            event.preventDefault();
            $('#showmap').dialog({
                title: '取车地址',
                onClose: function () {
                    $(this).dialog('close');
                },
                buttons: [{
                    text: '取消',
                    'click': function () {
                        $(this).dialog('close');
                    }
                }, {
                    text: '确定',
                    'class': 'btn-primary',
                    'click': function () {

                        $(".setmap").val($("#suggestId").val());
                        $('#showmap').dialog('close');
                    }
                }]
            })
            map.centerAndZoom("北京", 11);      // 用城市名设置地图中心点
        });

        //上传图片
        function addactpic(a) {
            $(".upload2").get(a).click();
        };
        //删除图片
        function del(x, picid) {
            $.ajax({
                url: "http://60.205.223.142/carscraporder-manager/carattachment/" + picid,
                type: "DELETE",
                dataType: "json",
                success: function (obj) {
                    //console.log(obj);
                    if (obj.msg == "success") {
                        $(x).parent().parent().children("img").attr("src", "../img/addimg-bg.png");
                        $(x).parent().parent().children("input[type='hidden']").val("");
                        $(x).parent().html("");
                    }
                }
            });
        }
        function doUpload2(a) {
            var formData = new FormData();
            if ($(".upload2")[a].files.length == 0) {
                alert("请选择pc母版！");
                return false;
            };
            var pics = $(".upload2")[a].files[0].name;
            if (!/\.(jpg|png|gif|jpeg|JPG|PNG|GIF|JPEG)$/.test(pics)) {
                alert("请上传正确图片格式");
                $(".upload2").val("");
                return;
            };
            var sizes = $(".upload2")[a].files[0].size;
            var pan = Math.round(sizes / 1024 * 100) / 100;
            if (pan > 4096) {
                alert("所传图片不能大于4M");
                //$(".upload2").val("");
                return;
            };
            var picszhui = pics.split('.')[1];
            var cid = $("#clid").val();
            var picsqian = $(".addpic").eq(a).parent().children("p").html();
            var businessType = $(".addpic").eq(a).children(".bigca").text();
            var pictureType = $(".addpic").eq(a).children(".smallca").text();
            //console.log(businessType + "=====" + pictureType);
            var newfile = $(".upload2")[a].files[0];
            var newname = picsqian + "." + picszhui;
            var dfl = new File([newfile], newname, { type: newfile.type });
            formData.append("files", dfl);
            $.ajax({
                url: "http://60.205.223.142/carscraporder-attachment/upload/carattachment/" + cid + "?businessType=1&pictureType=" + businessType + "&picturePecialType=" + pictureType,
                type: "POST",
                data: formData,
                dataType: "json",
                async: false,
                cache: false,
                contentType: false,
                processData: false,
                success: function (obj) {
                    if (obj.msg == "success") {
                        if (obj.data.length) {
                            $(".addpic").eq(a).children("img").attr("src", obj.data[0].url);
                            var id = obj.data[0].id;
                            $(".addpic").eq(a).children("input[type='hidden']").val(id);
                            var delinfo = '<button type="button" class="del-btn" onclick="del(this,' + id + ')"><span class="glyphicon glyphicon-remove"></span></button>';
                            $(".addpic").eq(a).children(".delpic").html(delinfo);
                        }
                    };
                },
                error: function (returndata) {
                    alert("操作失败");
                }
            });
        };

        //根据车架号查询车型名称
        $(".carjia").on("blur", function () {
            if ($(".carjia").val()) {
                var index = layer.msg('<span style="font-size:20px">数据加载中</span>', {
                });
                $.ajax({
                    type: "get",
                    url: href + "carModel?vin=" + $(".carjia").val(),
                    dataType: "json",
                    success: function (data) {
                        if (data.msg == "success") {
                            layer.close(index);
                            if (data.data == "") {
                                $(".carxing").val("");
                                $(".carxing").attr("placeholder", '车辆型号无法识别，请自行填写')
                                $(".carxing").attr("disabled", false)
                            } else {
                                $(".carxing").attr("disabled", "disabled");
                                $(".carxing").val(data.data)
                            }
                        }
                    }
                });
            }
            else {
                $(".carxing").attr("disabled", "disabled");
                $(".carxing").val("");
                $(".carxing").attr("placeholder", '');
            }
        });

    </script>
</body>
</html>
